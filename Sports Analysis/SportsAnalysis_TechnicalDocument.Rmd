---
title: "Assignment 2"
author: "Group 4"
date: "2021.02.24"
output:
  pdf_document: 
     toc: true
     toc_depth: 3
urlcolor: blue
---

```{r import, include = F}
library(tidyverse)
library(dbplyr)
library(RSQLite)
library(rvest)
library(viridis)
library(arules)
library(arulesViz)
library(tidyr)
library(magrittr)
library(stringr)
library(cluster)
library(factoextra)
library(fmsb)

setwd("C:/Users/sherr/Sherry/Carlson/Courses/Spring-2020/6410_ExploratoryDataAnalysis2/HW2_Sports Analytics/Sports Analytics/scripts")

con <- src_sqlite("euro_soccer.sqlite")

country_tbl <- tbl(con, "country")
league_tbl <- tbl(con, "league")
match_tbl <- tbl(con, "match")
player_tbl <- tbl(con, "player")
player_atts_tbl <- tbl(con, "player_attributes")
team_tbl <- tbl(con, "team")
team_atts_tbl <- tbl(con, "team_attributes")
player<-player_tbl%>%collect()
match<-match_tbl%>%collect()
```


```{r match results, include = F}
# Step 1: Create df with each match and some basic information
team<-team_tbl%>%collect()
match_results <- match_tbl %>%
  select(season, date, league_id, match_id = id, match_api_id, home_team_api_id,
         away_team_api_id, home_team_goal, away_team_goal) %>%
  mutate(home_team_result = case_when(
    home_team_goal > away_team_goal ~ 'W',
    home_team_goal == away_team_goal ~ 'D',
    home_team_goal < away_team_goal ~ 'L'
  ),
  away_team_result = case_when(
    home_team_goal < away_team_goal ~ 'W',
    home_team_goal == away_team_goal ~ 'D',
    home_team_goal > away_team_goal ~ 'L')
  ) %>%
  collect() %>%
  pivot_longer(cols = home_team_api_id:away_team_api_id, names_to = 'home_away',
               values_to = 'team_id') %>%
  left_join(team_tbl %>%
              select(team_id = team_api_id, team_long_name) %>%
              collect(),
            by = 'team_id') %>%
  left_join(league_tbl %>%
              select(league_id = id, league_name = name) %>%
              collect(), 
            by = 'league_id') %>%
  mutate(home_away = str_remove(home_away, '_team_api_id')) %>%
  pivot_longer(c(home_team_goal, away_team_goal), names_to = 'home_away_goal',
               values_to = 'goals') %>%
  mutate(home_away_goal = str_remove(home_away_goal, '_team_goal')) %>%
  pivot_longer(c(home_team_result, away_team_result), 
               names_to = 'home_away_result', values_to = 'result') %>%
  mutate(home_away_result = str_remove(home_away_result, '_team_result')) %>%
  filter(home_away == home_away_goal & home_away_goal == home_away_result) %>%
  group_by(match_api_id) %>%
  mutate(goals_against = rev(goals),
         opponent = rev(team_long_name),
         opponent_id = rev(team_id)) %>%
  select(season, date, match_id, match_api_id, league = league_name, home_away, 
         team_id, team = team_long_name, opponent_id,
         opponent, goals, goals_against, result)

# Step2: Create df of each league standings (team wins/losses/points)
get_table <- function(season){
  n = case_when(
    season == 2016 ~ 1535,
    season == 2017 ~ 1640,
    season == 2018 ~ 1896,
    season == 2019 ~ 3260
  )
  url = paste0("https://fbref.com/en/comps/11/", n, "/", season, "-", 
               season + 1, "-Serie-A-Stats")
  table <- read_html(url) %>%
    html_nodes('table') %>%
    html_table()
  
  table1 <- table[[1]] %>%
    select(team = Squad, pts = Pts, goals = GF, 
           goals_against = GA, games = MP)  %>%
    mutate(season = paste0(season, '/', season+1),
           league = 'Italy Serie A')
  
  return(table1)
}

league_tables <- match_results %>%
  mutate(pts = 3*(result == 'W') + (result == 'D')) %>%
  group_by(season, league, team_id, team) %>%
  summarize(across(c(goals, goals_against, pts), sum),
            games = n()) %>%
  bind_rows(lapply(2016:2019, get_table) %>%
              data.table::rbindlist()) %>%
  mutate(goal_differential = goals - goals_against) %>%
  arrange(league, season, desc(pts)) %>%
  mutate(pts_pct = pts/(3*games)) %>%
  ungroup() %>%
  group_by(season, league) %>%
  arrange(league, season, desc(pts), desc(goal_differential)) %>%
  mutate(rank = rank(-pts,  ties.method = 'first'))

# Step3: Add players to match results
matches_players<- match_results %>%
  left_join(
    match_tbl %>%
      select(match_api_id, contains('player'), -contains('player_X'),
             -contains('player_Y')) %>%
      collect()
  )%>%filter(team_id==8686)

match_with_players <- matches_players %>%
  pivot_longer(cols = home_player_1:away_player_11, names_to = 'player_num', 
               values_to = 'player_id') %>%
  filter(str_detect(player_num, home_away))

# Step 4: Add player Position information 
player_positions <- match_tbl %>%
  select(match_api_id, home_team_api_id, away_team_api_id, 
         home_player_X1:away_player_11) %>%
  collect() %>%
  pivot_longer(home_player_1:away_player_11, names_to = 'player', 
               values_to = 'player_id') %>%
  pivot_longer(home_player_X1:away_player_Y11, names_to = 'player_pos', 
               values_to = 'player_xy') %>%
  filter(str_sub(player, 1, 4) == str_sub(player_pos, 1, 4),
         parse_number(player) == parse_number(player_pos)) %>%
  mutate(player_pos = str_sub(str_remove(player_pos, '[:digit:]+'), -1, -1)) %>%
  pivot_wider(names_from = 'player_pos', values_from = 'player_xy') %>%
  mutate(position = case_when(
    Y == 1 ~ 'GK',
    Y == 3 ~ 'DEF',
    Y %in% 4:8 ~ 'MID',
    Y %in% 9:12 ~ 'ATT')
  )
# Get Position Pivot Table
match_position<-player_positions%>%filter(str_detect(player,'home_player'))%>%
  group_by(match_api_id,home_team_api_id,position)%>%
  summarise(num=n())%>%
  pivot_wider(names_from = position, values_from = num)%>%
  left_join(match_results,by=c('match_api_id'='match_api_id',
                               'home_team_api_id'='team_id'))

player_position_count<-player_positions%>%filter(str_detect(player,'home_player'))%>%
  group_by(player_id,position)%>%
  summarise(num=n())%>%
  pivot_wider(names_from = position, values_from = num)
# Step5: Add Player attributes
roma_players<-distinct((match_with_players%>%filter((team_id==8686)&(date>2016)))['player_id'])
avector = c()
for(atmp in roma_players) { avector <- atmp }
attr<-player_atts_tbl %>%
              select(-id) %>%
              collect()
player_attr<-attr%>%
       group_by(player_fifa_api_id)%>%
       summarise_all(funs(if(is.numeric(.)) mean(., na.rm = TRUE) else first(.)))%>%
       left_join(player,by='player_api_id')%>%
       left_join(player_position_count,by=c('player_api_id'='player_id'))
roma_player_attr<-player_attr %>% filter(player_api_id %in% avector)
#Step 6: Calculate odds for each of Roma's matches and how many points Roma missed compared to expectation from betting odds
roma_odds <- match_tbl %>%
  select(season, id, match_api_id, home_team_api_id, away_team_api_id, 
         home_team_goal, away_team_goal, B365H:BSA) %>%
  mutate(season = as.numeric(str_sub(season, 1, 4))) %>%
  collect() %>%
  mutate(home_team_result = case_when(
    home_team_goal > away_team_goal ~ 'W',
    home_team_goal == away_team_goal ~ 'D',
    home_team_goal < away_team_goal ~ 'L'
  ),
  away_team_result = case_when(
    home_team_goal < away_team_goal ~ 'W',
    home_team_goal == away_team_goal ~ 'D',
    home_team_goal > away_team_goal ~ 'L')
  ) %>%
  pivot_longer(cols = home_team_api_id:away_team_api_id, names_to = 'home_away',
               values_to = 'team_id') %>%
  left_join(team_tbl %>%
              select(team_id = team_api_id, team = team_long_name) %>%
              collect(),
            by = 'team_id') %>%
  filter(team == 'Roma') %>%
  pivot_longer(cols = B365H:BSA, names_to = 'book', values_to = 'odds')
### Calculate how many points Roma missed compared to expectation from betting odds
roma_missed_pts <- roma_odds %>%
  filter(!is.na(odds),
        season %in% 2013:2015) %>%
  separate(col = book, into = c('book', 'winner'), sep = -1) %>%
  mutate(across(odds, function(x) 1/x),
         roma_home_away = toupper(str_sub(home_away, 1, 1))) %>%
  mutate(proj_roma_result = case_when(
    winner == roma_home_away ~ 'W',
    winner == 'D' ~ 'D',
    winner != roma_home_away ~ 'L'
  )) %>%
  mutate(actual_roma_result = ifelse(roma_home_away == 'H', home_team_result, 
                                     away_team_result)) %>% 
  group_by(season, id, match_api_id, home_team_goal, 
           away_team_goal, proj_roma_result, actual_roma_result) %>%
  summarize(across(odds, mean, na.rm = T)) %>%
  mutate(proj_pts = odds*case_when(
    proj_roma_result == 'W' ~ 3,
    proj_roma_result == 'D' ~ 1,
    proj_roma_result == 'L' ~ 0
  )) %>%
  ungroup() %>%
  group_by(season, id, match_api_id, actual_roma_result) %>%
  summarize(across(proj_pts, sum, na.rm = T)) %>%
  mutate(actual_pts = case_when(
    actual_roma_result == 'W' ~ 3,
    actual_roma_result == 'D' ~ 1,
    actual_roma_result == 'L' ~ 0
    )) %>%
  mutate(team = 'Roma') %>%
  left_join(match_results %>% select(match_api_id, team, opponent), 
            by = c('match_api_id', 'team')) %>%
  group_by(opponent) %>%
  summarize(across(c(proj_pts, actual_pts), sum),
            games = n()) %>%
  mutate(total_missed_pts = proj_pts - actual_pts,
         missed_pts_per_season = total_missed_pts/games*2) %>%
  arrange(-missed_pts_per_season) %>%
  ungroup()
```


## 1. Introduction 

Our client, AS Roma, has consistently been one of the top teams in Italy Series A since 2009. While this represents a quality team, we are hoping to improve our performance so that we can earn more bids to the UEFA Championsâ€? League. Qualifying for the Champions League will award the team greater prize money and will help build the exposure and fan base of our team. Our goal is to identify how far away we are now and how many more matches we need to win, opponents that we have consistently struggled against, and then understand what strategies can be applied against those teams to improve our success in those matches.

We believe that if we play against Inter and Atalanta and convert our losses to win against them by playing more defensive against Atalanta with a team formation of 4-5-1 and semi defensive-offensive against Inter with a team formation of 3-4-3, our probability of winning against Atalanta and Inter will be 76% and 43% respectively which are higher than the current level.


## 2. Background

Since the 2008-2009 season, Roma has consistently finished as one of the top teams in Serie A. In the below graph you can see the average points of the top performing teams: those that averaged over 50 pts each season.

```{r pressure, echo=FALSE, out.width = '100%'}
league_tables %>%
  filter(league == 'Italy Serie A') %>%
  group_by(team) %>%
  summarize(across(pts, mean)) %>%
  filter(pts >= 50) %>%
  mutate(roma = team == 'Roma') %>%
  ggplot(aes(reorder(team, pts), pts)) +
  geom_col(aes(fill = roma)) +
  coord_flip() +
  xlab('Team') +
  ggtitle("Roma has finished with the second most average points since 2008-2009") +
  theme_bw() +
  scale_fill_manual(values = c('lightgrey', 'black')) +
  theme(legend.position = 'none',
        plot.title = element_text(size = 12))
```

Looking at average points over that time gives us a general idea of where each team has stood over that period of time. The graph shows that Roma is considerably behind Juventus for the top spot and very tightly ranked with the next 3 teams: Napoli, Inter, and Milan. This tells us that focusing efforts on overcoming Juventus would prove frivolous, as creating a team that performs on average 12 points better each season would likely take a long time and a major overhaul.

Rather than focus on finishing as the top team in the league tables, perhaps Roma should look to qualifying for the Championsâ€? League. Since the 2008-2009 season, Roma has qualified 6 of the 12 seasons. They earned automatic qualification 5 times and advanced through the qualifying stages once. UEFA updated qualification standards in 2018-2019 where the top 4 teams now earn automatic qualification. If we retroactively apply these standards to the past 12 seasons, Roma would have still qualified 6 times. Roma has performed moderately well over those 12 seasons in earning qualification.

However, zooming in on the past 3 seasons, Roma has qualified in just 1 of those seasons. We are going to look at these past 3 seasons, as they give us a sample of over 100 matches played, and indicate a stretch of play where there is evident room for improvement. This table shows how many points Roma scored in each of the past 3 seasons compared to the last team that earned qualification to the Championsâ€? League.

```{r, echo=FALSE, out.width = '100%'}
knitr::include_graphics("table.png")
```

In the past 3 seasons, Roma finished 3rd, 6th, and 5th. They finished 5 points above 4th, 3 points behind 4th, and 8 points behind 4th, respectively. On average for those 3 seasons, they finished 2 points below 4th place. We will examine each of Romaâ€™s matches from these 3 seasons and identify matches in which Roma underperformed. 
 
## 3. Goal, Success Metric 
Our primary goal is to perform at per betting odds expectations to increase our points to improve Roma position to finish in the top 4 teams.

## 4. Logit Chain
### Question 1: What are the target opponents that Roma should mainly focus on?
If Roma can earn 2 more points on average each season, that will allow the team to further cement itself in the second tier of teams, and will improve the teamâ€™s odds of qualifying for the Championsâ€? League. We want to find opponents against which Roma has consistently underperformed and look how to improve in such matches. To find these matches, we examined how Roma was expected to perform according to odds set by 10 different oddsmakers. Oddsmakers consistently predict the result of a match better than anyone else. Since the 2008-2009 season, the aggregate of the 10 oddsmakers was able to correctly predict which team was the victor or whether there was a draw over 53% of the time. The odds for each match were gathered from a Kaggle dataset featuring data from 11 different leagues.

From the provided odds, we can gather what is referred to as the â€œimplied probability,â€? which signifies the chances that Roma will win, draw, or lose. Using the average of all these probabilities, we can calculate the expected points that Roma would earn for each match. Lastly, we found out how many points Roma earned against each team, and how many more/less they earned compared to oddsâ€? expectations.

In examining Romaâ€™s performance, we used data from the 2013-2014 season to the 2015-2016 season, as those were the most recent seasons and they would give us over 100 matches to work with.

In searching for matches where we could improve, we examined Romaâ€™s performance against each team and how they performed compared to expectations heading into the game. The pregame expectations were defined by the betting odds set by 10 different oddsmakers. Each oddsmaker provides an opportunity for a bettor to wager whether Roma will win, draw, or lose a match. For each result there is a specific payout that the bettor will earn for every $1 they wager on a specific result. These values can be converted into what is referred to as the â€œimplied probability,â€? which signifies the chances that Roma will win, draw, or lose. Using the average of all these probabilities, we can calculate the expected points that Roma would earn for each match. Lastly, we found out how many points Roma earned against each team, and how many more/less they earned compared to oddsâ€? expectations.

The data for the betting odds runs from the 2008-2009 season until the 2015-2016 season. We used data from the 2013-2014 season to the 2015-2016 season, as those were the most recent seasons and they would give us over 100 matches to work with. [The reason for not using the previous seasons data has been given above]

```{r, echo=FALSE, out.width = '100%'}
roma_missed_pts %>%
  filter(games > 5, opponent != 'Chievo Verona') %>%
  mutate(teams = opponent %in% c('Atalanta', 'Inter')) %>%
  ggplot(aes(reorder(opponent, missed_pts_per_season), missed_pts_per_season)) +
  geom_col(aes(fill = teams)) +
  coord_flip() +
  theme_bw() +
  ylab('Missed points per season') +
  xlab('Opponent') +
  ggtitle("Roma underperformed against Atalanta by over 1 point per season",
          subtitle = "They also lost close to 1 point against Juventus, Sampdoria, and Inter\nData runs from 2013-14 season to 2015-2016 season") +
  theme(axis.text.y = element_text(face = c(rep("plain", 9), "bold", rep("plain", 2), "bold"),
                                   color = c(rep("grey45", 9), "black", rep("grey45", 2), "black")),
        legend.position = 'none') +
  scale_fill_manual(values = c('grey45', 'black'))
```

The graph above shows the 13 teams that have been in Serie A the past 3 seasons as well as this season. The teams at the top are those that Roma underperformed against the most. The horizontal bar represents how many points we missed out on per season against each team. For example, Roma earned 1.3 points fewer than expected against Atalanta per season over those 3 seasons. Roma earned over 2 points each season from their matches against Fiorentina.

We sought to identify teams that if we perform up to expectations, we can raise our points by 2. Atalanta was a clear choice, as Roma performed substantially worse against them compared to the other teams. Moreover, Atalanta has finished in 7th, 3rd, and 3rd in Serie A the past 3 seasons, so our matches against them are even more important. Performing as expected against Atalanta would increase Romaâ€™s points by 1.3 each season on average. 

Roma performed similarly against Juventus, Sampdoria, and Inter compared to expectations. Since Inter is also a direct competitor to Roma for qualification (4th, 4th, 2nd place finishes), we decided we would target strategies to help Romaâ€™s performance against Inter also. Performing as expected against Inter would increase Romaâ€™s points by 0.7 on average. If Roma can perform at expectation against each of those two teams, they would score close to 2 points more on average each season. Furthermore, for each point they can gain against these opponents, that corresponds to one fewer point earned by Atalanta and Inter, which is an additional benefit for Romaâ€™s standing in the league table.

### Question 2: What are the Strategies Against Target Opponents?
As Atalanta and Inter are our competitive teams from the last 3 seasons, winning against them will not only improve our points but it will also lower the overall betting odds points that are required to qualify for the upcoming champions leagues. This will ensure we have more time to improve our strategies for the upcoming seasons and more bandwidth to experiment with. We analyzed the strategies mainly from the perspectives of team formation strategies and player combination. 

### Question 2-1: What Team Formation is the most effective ?

```{r Formation Atalanta, echo = F, message = F}
#Atalanta
opp_id<-8524
opp='Atalanta'
match_results_1<-match_results%>%filter(team_id==opp_id)
match_position_1<-match_position%>%filter(opponent_id==opp_id)

#Get best team structure
df_rule<-match_position_1[c('ATT','DEF','GK','MID',
                            'result','home_team_api_id')]%>%
  mutate_at(c('ATT','DEF','GK','MID','result'),as.factor)
df_rule['team_structure']=paste(df_rule$DEF,'-',df_rule$MID,'-',df_rule$ATT)
df_rule_home<-df_rule%>%filter(home_team_api_id==8686)
pattern<-df_rule%>%group_by(team_structure,result)%>%summarize(num=n())%>% 
  pivot_wider(names_from = result, values_from = num)
pattern[is.na(pattern)] <- 0
pattern['total_match']<-pattern$D+pattern$W+pattern$L
pattern['win_rate']<-pattern$W/pattern$total_match
# Visualize Best Team Structure
pattern %>% filter(total_match>=10)%>%
  ggplot(aes(x = reorder(team_structure, desc(win_rate)),, y = win_rate, 
             fill = team_structure)) +
  geom_bar(stat = "identity",alpha=0.6,width=0.4)+
  theme_bw() +
  labs(
    x = paste("Team Formation (DEF-MID-ATT)"),
    y = "Winning Rates",
    title = paste("Best Team Formation When Facing",opp)
  )
```

Once we locked onto the teams, we analyzed all the matches played by Atalanta and Inter respectively to find the most effective strategies for beating them. Amongst the games played against Atalanta, Roma has been historically using the 4-5-1 and 4-3-3 formations. However, the most effective team formation against Atalanta based on winning rate is 4-5-1. 

```{r Formation Inter, echo = F, message = F}
#Inter
opp_id<-8636
opp='Inter'
match_results_1<-match_results%>%filter(team_id==opp_id)
match_position_1<-match_position%>%filter(opponent_id==opp_id)

#Get best team structure
df_rule<-match_position_1[c('ATT','DEF','GK','MID','result',
                            'home_team_api_id')]%>%
  mutate_at(c('ATT','DEF','GK','MID','result'),as.factor)
df_rule['team_structure']=paste(df_rule$DEF,'-',df_rule$MID,'-',df_rule$ATT)
df_rule_home<-df_rule%>%filter(home_team_api_id==8686)
pattern<-df_rule%>%group_by(team_structure,result)%>%summarize(num=n())%>% 
  pivot_wider(names_from = result, values_from = num)
pattern[is.na(pattern)] <- 0
pattern['total_match']<-pattern$D+pattern$W+pattern$L
pattern['win_rate']<-pattern$W/pattern$total_match
# Visualize Best Team Structure
pattern %>% filter(total_match>=10)%>%
  ggplot(aes(x = reorder(team_structure, desc(win_rate)),, y = win_rate, 
             fill = team_structure)) +
  geom_bar(stat = "identity",alpha=0.6,width=0.4)+
  theme_bw() +
  labs(
    x = paste("Team Formation (DEF-MID-ATT)"),
    y = "Winning Rates",
    title = paste("Best Team Formation When Facing",opp)
  )
```

Similarly, while Roma has been using the 4-3-3 formation more commonly when facing Inter Milan, 3-4-3 seems to be the most effective formation. Roma can switch to a less defensive and more flexible strategy to perform better against Inter Milan.

### Question 2-2: What is the best Player Strategy? 

Next we did association rule mining to discover the best player combinations. Each player has strengths and weaknesses, cooperation will complement the weaknesses and make the best use of the strengths.   

```{r,include=F}
max_min <- data.frame(
  player_name=c(100,0),player_api_id = c(100, 0),defensive_work_rate=c(100,0),attacking_work_rate =c(100,0),MID=c(100,0),DEF=c(100,0),ATT=c(100,0),GK=c(100,0),free_kick_accuracy = c(100, 0), ball_control = c(100, 0), sprint_speed = c(100, 0),
  gk_handling = c(100, 0), sliding_tackle = c(100, 0)
)
rownames(max_min) <- c("Max", "Min")
#%>%filter(defensive_work_rate=='high')
df <- rbind(max_min, player_attr[c('player_name','player_api_id','defensive_work_rate','attacking_work_rate','MID','DEF','ATT','GK',
                                        'free_kick_accuracy','ball_control',
                                        'sprint_speed','gk_handling','sliding_tackle')])
matches_players
df_rule<-matches_players[,c(13:24)]%>%mutate_all(as.factor)
rules = apriori(df_rule,parameter = list(supp = 0.04, conf = 0.5, minlen=3), appearance = list(rhs=paste0("result=", unique(df_rule$result))))
# inspect(sort(rules, decreasing = TRUE, na.last = NA, by = "lift"))
subrules <- subset(rules, lift>1.3)
```


```{r,echo = F, message = F}
plot(subrules, method="graph")
```
```{r,echo = F, message = F}
create_beautiful_radarchart <- function(data, color = "#00AFBB", 
                                        vlabels = colnames(data), vlcex = 0.7,
                                        caxislabels = NULL, title = NULL, ...){
  radarchart(
    data, axistype = 1,
    # Customize the polygon
    pcol = color, pfcol = scales::alpha(color, 0.5), plwd = 2, plty = 1,
    # Customize the grid
    cglcol = "grey", cglty = 1, cglwd = 0.8,
    # Customize the axis
    axislabcol = "grey", 
    # Variable labels
    vlcex = vlcex, vlabels = vlabels,
    caxislabels = caxislabels, title = title, ...
  )
}
# Reduce plot margin using par()
op <- par(mar = c(1, 2, 2, 2))
df_1<-df[c("Max", "Min", '232','4210'), c('free_kick_accuracy','ball_control','sprint_speed','gk_handling','sliding_tackle')]
# Create the radar charts
create_beautiful_radarchart(
  data = df_1, caxislabels = c(0,25,50,75,100),
  color = c("#00AFBB","#E7B800")
)
# Add an horizontal legend
legend(
  x = "bottom", legend = c('Morgan De Sanctis \n (Goal Keeper)',
                           'Leandro Castan\n (Defender)' ), horiz = TRUE,
  bty = "n", pch = 20 , col = c("#00AFBB","#E7B800"),
  text.col = "black", cex = 1, pt.cex = 1.5
  )
par(op)
```

Leandro Castan & Morgan De Sanctis is the best defensive pairs. They both have accellent defensive ability. According to the historical match results, matches that they played together had  54% higher winning rate than matches that they played separately.  Morgan and Leandro together can serve a solid backline for the team.

```{r,echo = F, message = F}
# Reduce plot margin using par()
op <- par(mar = c(1, 2, 2, 2))
df_1<-df[c("Max", "Min", '79','1249'), c('free_kick_accuracy','ball_control','sprint_speed','gk_handling','sliding_tackle')]
# Create the radar charts
create_beautiful_radarchart(
  data = df_1, caxislabels = c(0,25,50,75,100),
  color = c("#00AFBB","#E7B800")
)
# Add an horizontal legend
legend(
  x = "bottom", legend = c('Francesco Totti \n (Attack)',
                           'Daniele De Rossi\n (Mid)' ), horiz = TRUE,
  bty = "n", pch = 20 , col = c("#00AFBB","#E7B800"),
  text.col = "black", cex = 1, pt.cex = 1.5
  )
par(op)
```
Francesco Totti & Daniele De Rossi is the best attacking pair whose ability supplements with each other. Francesco has high kick accuracy and excellent ball control ability, which make him a good attacker. Danieleâ€™s sliding tackle skills added to the teamâ€™s defence power while higher sprint speed made him more flexible to assist the frontline. According to the historical match results, matches that they played together had 34.4%  higher winning rate than matches that they played separately. Francesco Totti and 	Daniele De Rossi together can serve as a good forward combination.

## 6. Conclusion
After our analysis, we believe that Roma can increase its probability of finishing in the top 4 teams to Qualify for the Champions League by converting their losses to win against Inter and Atalanta. To increase their competitiveness against those two teams, Roma can apply the following strategies respectively:  
1. Play more defensively against Atalanta with the team formation of 4-5-1.  
2. Play semi defensive-offensive with a team formation of 3-4-3  
3. Assign Leandro Castan & Morgan De Sanctis play together to improve Romaâ€™s defensive power  
4. Assign Francesco Totti & Daniele De Rossi to improve Roma attacking ability.  
 
## 7. Appendix: 

Assumption:

Roma players stay the same over time.

Glossary: 
In this section, we will present a brief introduction to the points that are mentioned in the technical and/or managerial document that might require some basic knowledge. 

Team Formation:
A football, or soccer formation is a basic shape of a soccer team. Most football formations are described in numbers of outfield players from the defense forward [goalkeeper is usually not mentioned and is implied]. So 4-2-4 for example, means four defenders, two midfield players and four attackers. To be successful, a team must have some shape so that players know where they should play and where their teammates will be. Successful formations balance attack and defense and make the best use of the players in a team. In our analyses, defenders are abbreviated as DEF, midfield as MID and attackers are ATT. As mentioned above, the single player in the left of the picture is goalkeeper and is usually not mentioned [We follow the same convention].
```{r, echo=FALSE, out.width = '100%'}
knitr::include_graphics("formation.png")
```
